{
  "manifest": {
    "id": "jkanime-es-streaming",
    "name": "JKAnime Español (Streaming)",
    "version": "1.0.0",
    "author": "Grok (basado en jkanime-v2 API)",
    "description": "Extensión para streaming de anime en español desde JKAnime.net via API scraper. Soporta búsqueda, episodios y enlaces a Magi, Filemoon, Mixdrop, etc.",
    "type": "streaming",
    "icon": "https://jkanime.net/assets/images/logo.png"
  },
  "payload": "// Extensión para JKAnime usando API scraper[](https://github.com/chrismichaelps/jkanime-v2)\n// Base URL de la API (ajusta si hosteas tu propia instancia)\nconst API_BASE = 'https://jkanime-api.chrismichaelps.workers.dev/api/v1';\n\n// Función de búsqueda de animes\nexport async function searchAnime(options) {\n  const { query, limit = 20 } = options;\n  try {\n    const res = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}&limit=${limit}`);\n    const data = await res.json();\n    if (!data.animes) return [];\n    return data.animes.map(anime => ({\n      id: anime.id || anime.slug,\n      title: anime.title,\n      image: anime.poster || anime.image,\n      description: anime.synopsis || '',\n      status: anime.status || 'Ongoing',\n      year: anime.year || null,\n      type: anime.type || 'Serie'\n    }));\n  } catch (e) {\n    console.error('Error en búsqueda JKAnime:', e);\n    return [];\n  }\n}\n\n// Función para obtener episodios de un anime\nexport async function getEpisodes(id) {\n  try {\n    const res = await res.json();\n    const data = await res.json();\n    if (!data.episodes) return [];\n    return data.episodes.map(ep => ({\n      number: ep.number,\n      title: ep.title || `Episodio ${ep.number}`,\n      id: ep.id || `${id}-ep${ep.number}`,\n      url: ep.url || `/episodio-${ep.number}/`  // Para compatibilidad, pero usamos ID para streams\n    }));\n  } catch (e) {\n    console.error('Error en episodios JKAnime:', e);\n    return [];\n  }\n}\n\n// Función para obtener streams de un episodio (llamado con episodeUrl o id)\nexport async function getStreams(episodeUrl, episodeId) {\n  const epId = episodeId || episodeUrl.split('-ep')[1] || '1';  // Extrae número si es URL\n  try {\n    const res = await fetch(`${API_BASE}/servers?anime=${encodeURIComponent(episodeUrl.split('/')[3])}&episode=${epId}`);\n    const data = await res.json();\n    if (!data.servers) return [];\n    return data.servers.map(server => ({\n      url: server.video || server.embed,  // URL proxy como https://jkanime.net/c4.php?...\n      quality: 'Auto',  // JKAnime no siempre especifica, usa 'Auto'\n      language: 'es',  // Español LATAM\n      server: server.server || 'Desconocido'\n    }));\n  } catch (e) {\n    console.error('Error en streams JKAnime:', e);\n    return [];\n  }\n}\n\n// Opcional: Función para home (animes populares)\nexport async function getHomePage() {\n  try {\n    const res = await fetch(`${API_BASE}/latest`);\n    const data = await res.json();\n    return {\n      'Ongoing': data.slice(0, 10).map(anime => ({ ...anime, id: anime.id })),\n      'Popular': []  // Añade /popular si la API lo tiene\n    };\n  } catch (e) {\n    return {};\n  }\n}"
}